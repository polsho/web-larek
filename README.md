# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура проекта

**Описание данных**

Интерфейс **IProduct** - для хранения данных модели продукта  
Содержит поля:
- id: string;
- title: string;
- description: string;
- image: string;
- price: number | null;
- category: ProductCategory;
- index: number;

Тип **ProductCategory** - описывает все варианты категорий продукта, используется в типе **CategoryClasses**, который описывает запись
ключ-значение, где ключ - это название категории, а значение - css класс, содержащий стили поля, отображающего категорию в карточке продукта

Интерфейс **ICardActions** - описывает событие по клику на карточку  
Содержит поле onClick

Интерфейс **IWebLarekApi** - описывает методы отправки и получения данных с сервера  
Содержит поля:
- etProductList - воозвращает промис с массивом данных продуктов 
- getProductInfo - возвращает промис с данными продкута по его id
- orderProducts - отправляет данные о заказе и возвращает результат запроса

Интерфейс **IPage** - описывает данные и свойства страницы  
Содержит поля:
- catalog - массив HTML элементов (карточек продукта)
- locked - булевое значение, говорящее о том, заблокирована страница или нет (при открытии модального окна)

Интерфейс **IModalView** содержит одно поле модального окна - его контент типа HTML элемента

Интерфейс **IBasketView** - описывает данные для отображения их в элементах корзины на странице  
Содержит поля:
- items - массив HTML элементов (карточек продукта, добавленных в корзину) 
- total - число, общая стоимость все продуктов в корзине 


Интерфейс **IFormState** - описывает данные, используемые в отображении формы  
Содержит поля:
- valid - булевое значение, означающее валидны ли введенные данные или нет
- errors - строка, описывающая ошибку, если введенные данные некорректны

Интерфейс **IOrderForm** - описывает данные, используемые в отображении формы заказа  
Содержит поля:
- methodPayment - строка, содержащая выбранный метод оплаты
- address - строка, содержащая адрес доставки
- email - строка, содержащая эл. адрес
- phone - строка, содержащая телефон

Интерфейс **IOrder** - описывает данные заказа   
Содержит поля:
- items[] - для хранения списка заказанных продуктов
- total - для хранения общей суммы стоимости заказа
- и все поля из *IOrderForm*

Тип **FormErrors** - запись ключ-значение, где ключ - это поле формы из интерфеса *IOrderForm*, а значение - текст ошибки

Интерфейс **IOrderResult** - описывает данные, полученнные в результате заказа  
Содержит поля:
- id
- total

Интерфейс **ISuccess**  
Содержит поле total - общая сумма заказа


**Использумеые события**

'items:show' - загрузка полученных с сервера данных в каталог на странице  
'card:select' - сохранение в поле класса состояния данных приложения id выбранной карточки  
'preview:show' - загрузка превью карточки в модельное окно  
'product:order' - добавление продукта в корзину  
'basket:open' - открытие модального окна с корзиной и загрузка выбранных продуктов  
'card:delete' - удаление продукта из корзины  
'formErrors:change' - проверка на наличие ошибок в полях формы и вывод текста ошибки  
'input:change' - отслеживает ввод данных полей формы  
'order:open' - открытие модального окна с первой формой оформления заказа  
'order:submit' - открытие модального окна со второй формой оформления заказа  
'contacts:submit' - отправка введенных данных на сервер и открытие модального окна с подтверждением созданного заказа    
'modal:open' - блокирует страницу при открытии модального окна  
'modal:close' - разблокирует страницу при закрытии модального окна  


**Базовые классы**

Класс **Api** - служит для связи с сервером, отправления и получения запросов  
Имеет методы: 
- handleResponse - первоначальная обработка получаемых данных через метод json
- get - получение запроса
- post - отправка запроса

Класс **EventEmitter** - служит для обработки событий  
Имеет методы:
- on - подписка на событие
- off - отписка от события
- emit - уведомление подписчиков о наступлении события 

Абстрактный класс-дженерик **View** служит для отрисовки DOM элементов.  
Конструктор принимает HTML элемент - контейнер  
Имеет методы:
- setText - устанавливает значение поля TextContent
- setDisabled - включает или выключает блокировку объекта
- setImage - устанавливает значения для отображения изображения
- render - принимает данные, которые будут отображаться в элементе и возвращает этот элемент


**Компоненты представления**

Класс **Page** наследует класс View с реализацией интерфейса *IPage*  
Служит для отрисовки и установки значений некоторых элементов на странице  
Имеет поля типа HTMLElement:
- _catalog - элемент, в котором содержатся основные элементы-товары
- _wrapper - элемент-оборачивающий страницу
- _basket - элемент-кнопка для открытия корзины
- _counter - элемент на кнопке корзины, отображающий количество товаров в корзине
Имеет методы:
- set catаlog - устанавливает элементы-товары в соответствующий HTML элемент
- set locked - с помощью добавления класса блокирует страниц
- set counter - устанавливает число элементов в корзине как значение в соответствующий HTML элемент

Класс **Modal** наследует класс View с реализацией интерфейса *IModalView*  
Служит для отрисовки модального окна с контентом  
Имеет два поля с типом HTMLElement:
- closeButton - кнопка закрытия окна
- content - элемент окна с содержимым
Имеет методы: 
- открытия и закрытия окна (open, close)
- сеттер по установки контента окна
- render - устанавливает данные и возвращает элемент окна

Класс **Card** наследует класс View с реализацией интерфейсов *IProduct*  
Cлужит для отрисовки элемента карточки продукта на странице  
Имеет поля типа HTMLElement: _title, _price, _category, _image, _description, _button, _index    
Конструктор принимает элемент-контейнер и событие, которое навешивает по клику на кнопку карточки или саму карточку  
Имеет методы:
- cетторы полей интерфейса: id, title, category, image, description, price, index
- метод render - к родительскому методу добавлена блокировка кнопки покупки в случае 'бесценного' продукта

Класс **Basket** наследует класс View с реализацией интерфейса *IBasketView*  
Служит для отрисовки элемента корзины  
В конструкторе навещивается на кнопку оформления заказа событие 'order:open'  
Имеет поля с типом HTMLElement: 
- _list - HTML элемент, которые содержит основные элементы, добавленные в корзину
- _total - HTML элемент, содержащий число, отображающее общую сумму элементов корзины
- _button - HTML елемент-кнопка для оформления корзины 
Имеет методы: 
- set items - размещает список элементов корзины в соотвествующем HTML элементе
- total - устанавливает общее число элементов корзины в соотвествующем HTML элементе

Класс-дженерик **Form** наследует класс View с реализацией интерфейса *IFormState*  
Служит базовым классом для отрисовки форм  
Имеет поля с типом HTMLElement:
- _submit
- _errors
Имеет методы:
- onInputChange - инициализирует событие 'input:change/
- render 
- сетторы полей интерфейса valid, errors

Класс **Order** наследует класс Form с частичной реализацией интерфейса *IOrderForm*  
Служит для отрисовки полей первой формы оформления заказа  
Имеет поле _methodButtons для хранения массива всех кнопок с вариантами оплаты  
Имеет методы:
- resetPayment - для сброса со всех кнопок css класса активной кнопки выбора оплаты
- selectPayment - установка на кнопку css класса активной кнопки выбора оплаты
- сеттор поля интерфейса address
- render - к родительскому методу добавлен метод resetPayment

Класс **Contacts** наследует класс Form с частичной реализацией интерфейса *IOrderForm*   
Служит для отрисовки полей формы для ввода контактных данных   
Имеет сетторы полей интерфейса: email и phone

Класс **Success** наследует класс View  
Служит для отрисовки модального окна с сообщением о завершении оформления заказа  
Имеет поля:
- _close - HTML элемент-кнопка закрытия окна
- _total - поле для отображения общей суммы заказа


**Компоненты модели данных**

Класс **ProductItem** - основная модель для хранения данных о продукте  
Имеет поля, содержащие данные о самом продукте:
- id: string;
- title: string;
- description: string;
- image: string;
- price: number;
- category: ProductCategory;
- и поле events для хранения возможных для продукта событий

Класс **AppData** содержит состояние данных, полученных с сервера, а также в результате событий на странице  
Имеет поля:
- catalog - массив всех объектов класса ProductItem
- preview - строка, содержащая id продукта, открытого в отдельной карточки
- basket - массив объектов класса ProductItem, добавленных в корзину
- order - объект, содержащий поля с данными обеих форм заказа, а также массив id добавленных в корзину продуктов и поле total c общей суммой заказа
Имеет методы:
- setCatalog - устанавливает в поле catalog получаемый как аргумент массив объектов, поддерживающих интерфейс *Iproduct*
- setPreview - определяет в поле preview id выбранного для просмотра продукта и сообщает об открытии 
- addToBasket - добавляет в массив basket объект класса ProductItem
- deleteFromBasket - удаляет из массива basket объект класса ProductItem
- clearBasket - очищает массив объектов класса ProductItem в корзине
- clearOrder - очищает значения всех полей объекта заказа order
- getTotal - подсчитывает общую сумму полей price у объектов ProductItem в корзине
- validateOrder - проверяет валидность формы с помощью инициализации события 'formErrors:change', возвращает булевое значение
- setOrderField - метод сохранения полученных из формы данных с типом *IOrder* в поля объекта order


Класс **WebLarekApi** наследуется от класса Аpi и служит для получения информации о продуктах с сервера.  
Реализует интерфейс IGetProductApi  
Имеет методы:
- getProductList - возвращает промис с массивом объектов, реализующих интерфейс IProduct
- getProductInfo - получает как аргумент id продукта и возвращает промис с объектом, реализующим интерфейс IProduct
- orderProducts - отправляет данные заказа на сервер и возращает промис с объектом, реализующим интерфейс IOrderResult 